思源笔记移动端划线评论插件 - 开发需求规格说明书 (V1.0)
1. 项目目标
为思源笔记移动端（手机）开发一款插件，在文档的只读模式下，为用户提供流畅、直观的文本划线与行级备注功能，打造接近专业阅读APP（如微信读书）的沉浸式阅读与笔记体验。

2. 核心功能模块
文本标记 (Text Marking): 对选中的文本应用四种预设样式。

添加备注 (Commenting): 为选中的文本关联一段用户输入的注释性文字。

3. 详细用户交互 (UX) 流程
场景： 用户在手机上以只读模式浏览一篇长文。

Step 1: 触发 - 选择文本

用户通过长按并拖动选择器，选中一段希望操作的文本。

Step 2: 唤出 - 浮动工具栏

当用户手指离开屏幕（选择结束）的瞬间，一个简洁的浮动工具栏（Floating Toolbar）立即在所选文本的正上方或正下方出现（优先上方，空间不足则在下方）。

此工具栏为后续所有操作的入口。

如果用户点击页面上除工具栏外的任何其他区域，工具栏立即消失。

Step 3: 操作 - 执行划线或备注

工具栏设计:

深色半透明背景，圆角矩形设计。

包含5个图标按钮，从左到右依次为：

加粗 (B)

斜体 ( I )

下划线 (<u>U</u>)

高亮 (荧光笔图标)

备注 (对话气泡图标)

分支A：执行【文本标记】

用户点击工具栏上的加粗、斜体、下划线或高亮图标。

系统响应:

所选文本立即被应用相应样式。

浮动工具栏立即消失。

操作完成。

分支B：执行【添加备注】

用户点击工具栏上的备注（对话气泡）图标。

系统响应:

浮动工具栏立即消失。

所选文本被自动应用一种特殊的、表示“有备注”的高亮样式（例如：淡蓝色背景），给用户即时反馈。

屏幕从底部平滑弹出一个备注输入面板 (Bottom Sheet)。

备注输入面板:

顶部显示被选中的原文片段，作为引文。

中间是多行文本输入框，提示文字为“写下你的想法...”。

右上角有“保存”按钮。

左上角有“取消”或关闭图标。

用户输入备注内容后，点击“保存”。

系统响应:

备注内容被保存。

输入面板从底部平滑收起。

原文中那段淡蓝色的高亮文本保留。

操作完成。

Step 4: 后续操作 - 查看、修改与删除

用户单次点击任何已经被标记（无论哪种样式）过的文本。

系统响应:

再次唤出浮动工具栏，但此时工具栏上的按钮根据标记类型而变化。

情况1: 如果是普通划线/高亮文本:

工具栏按钮变为：[更换颜色] [添加备注] [取消划线]。

情况2: 如果是带有备注的高亮文本 (淡蓝色):

工具栏按钮变为：[编辑备注] [更换颜色] [删除备注]。

点击**[编辑备注]**，会再次从底部弹出备注输入面板，并载入已保存的内容供用户修改。

点击**[删除备注]**，会弹出确认框，确认后仅删除备注和关联关系，文本样式恢复为普通高亮。如果希望全部删除，可以再点一次文本，选择“取消划线”。

4. 技术实现规格
划线样式的存储:

加粗: **文本**

斜体: *文本*

下划线: <u>文本</u>

高亮: ==文本==

实现方式: 通过插件前端的 document.execCommand 或其他 DOM 操作 API 实时预览效果，用户确认后，调用思源 API updateBlock 将修改后的包含 Markdown 标记的内容写回块数据。

当前版本只实现加粗 下线 下划线 高亮功能 备注功能之后实现

这里代码我要求 结构化实现 保证足够精简.模块化实现. 对于这四种风格 我应该用一个模板, 传入不同的参数实现