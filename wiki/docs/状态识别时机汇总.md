# çŠ¶æ€è¯†åˆ«æ—¶æœºæ±‡æ€»

**æ›´æ–°æ—¥æœŸ**: 2025-10-02  
**ç‰ˆæœ¬**: v1.2.1

## ğŸ¯ å½“å‰è§¦å‘è¯†åˆ«é”çŠ¶æ€çš„æ—¶æœº

### 1ï¸âƒ£ **ç‚¹å‡»é”æŒ‰é’®æ—¶** âœ… å·²å®ç°ï¼ˆæ–°å¢ï¼‰
**è§¦å‘ä½ç½®**: `readonlyStateMonitor.ts`
```typescript
// äº‹ä»¶ä»£ç†ç›‘å¬é”æŒ‰é’®ç‚¹å‡»
document.addEventListener('click', (e) => {
    const readonlyBtn = target.closest('button[data-type="readonly"]');
    if (readonlyBtn) {
        // å»¶è¿Ÿ150msåè·å–æœ€æ–°çŠ¶æ€
        setTimeout(() => this.updateState(), 150);
    }
}, true);
```

**ç‰¹ç‚¹**ï¼š
- âœ… ä¸»åŠ¨ç›‘å¬ï¼Œç«‹å³å“åº”
- âœ… ä½¿ç”¨äº‹ä»¶ä»£ç†ï¼Œä¸ä¼šé—æ¼
- âœ… å»¶è¿Ÿ150msç­‰å¾…æ€æºå¤„ç†å®Œæˆ
- âœ… é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼ˆå¦‚å·¥å…·æ ç®¡ç†å™¨ï¼‰

---

### 2ï¸âƒ£ **Tabåˆ‡æ¢æ—¶** âœ… å·²å®ç°ï¼ˆå·²æœ‰ï¼‰
**è§¦å‘ä½ç½®**: `toolbarHijacker.ts`

#### æ–¹æ³•1: ç›‘å¬ protyle æ¨¡å¼åˆ‡æ¢äº‹ä»¶
```typescript
eventBus.addEventListener('message', (event) => {
    if (data.cmd === 'switch-protyle-mode') {
        Logger.log('ğŸ”„ æ£€æµ‹åˆ°protyleæ¨¡å¼åˆ‡æ¢äº‹ä»¶');
        this.refreshEditingStateCache();
    }
});
```

#### æ–¹æ³•2: ç›‘å¬çª—å£ç„¦ç‚¹å˜åŒ–
```typescript
window.addEventListener('focus', handleFocus);
document.addEventListener('focusin', handleFocus);
```

#### æ–¹æ³•3: ç›‘å¬DOMå˜åŒ–
```typescript
new MutationObserver((mutations) => {
    // æ£€æµ‹ .layout-tab-container æˆ– .protyle-wysiwyg çš„å˜åŒ–
    if (hasTabChange) {
        this.refreshEditingStateCache();
    }
});
```

#### æ–¹æ³•4: ç›‘å¬é€‰æ‹©å˜åŒ–
```typescript
document.addEventListener('selectionchange', () => {
    if (activeElement !== lastActiveElement) {
        this.refreshEditingStateCache();
    }
});
```

**ç‰¹ç‚¹**ï¼š
- âœ… å¤šé‡å¤‡ç”¨æ–¹æ¡ˆï¼Œç¡®ä¿ä¸é—æ¼
- âš ï¸ **æ³¨æ„**ï¼šè¿™äº›ç›‘å¬ä¸»è¦æ˜¯åˆ·æ–° `editingStateCache`ï¼Œä¸ç›´æ¥è°ƒç”¨ `readonlyStateMonitor`

---

### 3ï¸âƒ£ **é€‰ä¸­æ–‡æœ¬æ˜¾ç¤ºå·¥å…·æ å‰** âœ… å·²å®ç°
**è§¦å‘ä½ç½®**: `customToolbarManager.ts` ç¬¬87è¡Œ

```typescript
setupMouseSelectionListener(): void {
    const handleSelection = () => {
        // ğŸ” åœ¨å·¥å…·æ æ˜¾ç¤ºä¹‹å‰æ£€æŸ¥å½“å‰æ´»è·ƒæ–‡æ¡£çš„åªè¯»çŠ¶æ€
        const readonlyBtn = getCurrentActiveReadonlyButton();
        
        if (readonlyBtn) {
            const iconHref = readonlyBtn.querySelector('use')?.getAttribute('xlink:href') || '';
            isDocReadonly = iconHref !== '#iconUnlock';
        }
        
        // ğŸ”’ åªæœ‰åœ¨åŠ é”ï¼ˆåªè¯»ï¼‰çŠ¶æ€ä¸‹æ‰æ˜¾ç¤ºé«˜äº®å·¥å…·æ 
        if (!isDocReadonly) {
            return;
        }
        
        // æ˜¾ç¤ºå·¥å…·æ ...
    };
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ¯æ¬¡é€‰ä¸­æ–‡æœ¬éƒ½æ£€æŸ¥
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„ `getCurrentActiveReadonlyButton()`
- âœ… é˜²æ­¢åœ¨è§£é”çŠ¶æ€ä¸‹æ˜¾ç¤ºå·¥å…·æ 

---

### 4ï¸âƒ£ **ç‚¹å‡»é«˜äº®æ–‡æœ¬æ—¶** âœ… å·²å®ç°
**è§¦å‘ä½ç½®**: `highlightClickManager.ts` ç¬¬159è¡Œ

```typescript
private showDeleteConfirmDialog(highlightElement: HTMLElement): void {
    // ğŸ”’ æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å¤„äºé”å®šç¼–è¾‘çŠ¶æ€ï¼ˆåªè¯»æ¨¡å¼ï¼‰
    const isDocReadonly = isCurrentDocumentReadonly();
    
    if (!isDocReadonly) {
        Logger.log('â›” æ–‡æ¡£æœªé”å®šï¼ˆå¯ç¼–è¾‘çŠ¶æ€ï¼‰ï¼Œä¸æ˜¾ç¤ºå¿«é€Ÿåˆ é™¤å¯¹è¯æ¡†');
        return;
    }
    
    Logger.log('âœ… æ–‡æ¡£å·²é”å®šï¼ˆåªè¯»çŠ¶æ€ï¼‰ï¼Œæ˜¾ç¤ºå¿«é€Ÿåˆ é™¤å¯¹è¯æ¡†');
    // æ˜¾ç¤ºåˆ é™¤å¯¹è¯æ¡†...
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… ç‚¹å‡»é«˜äº®å‰æ£€æŸ¥
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„ `isCurrentDocumentReadonly()`
- âœ… åªåœ¨é”å®šçŠ¶æ€ä¸‹å…è®¸åˆ é™¤

---

### 5ï¸âƒ£ **å³é”®/é•¿æŒ‰å—ï¼ˆæ ‡ç­¾åŠŸèƒ½ï¼‰æ—¶** âœ… å·²å®ç°
**è§¦å‘ä½ç½®**: `tagManager.ts`

#### æ¡Œé¢ç‰ˆï¼šå³é”®æ—¶
```typescript
// ç¬¬87è¡Œ
document.addEventListener('contextmenu', (e) => {
    const blockElement = this.findBlockElementFromNode(target);
    
    if (blockElement) {
        // æ£€æŸ¥æ˜¯å¦å¤„äºåªè¯»çŠ¶æ€
        const isDocReadonly = isCurrentDocumentReadonly();
        
        if (isDocReadonly) {
            e.preventDefault();
            this.showTagPanel(blockElement);
        }
    }
});
```

#### æ‰‹æœºç‰ˆï¼šé•¿æŒ‰æ—¶
```typescript
// ç¬¬117è¡Œ
document.addEventListener('touchstart', (e) => {
    touchTimer = setTimeout(() => {
        // æ£€æŸ¥æ˜¯å¦å¤„äºåªè¯»çŠ¶æ€
        const isDocReadonly = isCurrentDocumentReadonly();
        
        if (isDocReadonly) {
            this.showTagPanel(blockElement);
        }
    }, 500);
});
```

**ç‰¹ç‚¹**ï¼š
- âœ… å³é”®/é•¿æŒ‰å‰æ£€æŸ¥
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„ `isCurrentDocumentReadonly()`
- âœ… åªåœ¨é”å®šçŠ¶æ€ä¸‹å…è®¸æ‰“æ ‡ç­¾

---

### 6ï¸âƒ£ **æ‰§è¡Œå†™å…¥æ“ä½œå‰ï¼ˆå…œåº•é˜²å¾¡ï¼‰** âœ… å·²å®ç°
**è§¦å‘ä½ç½®**: `operationWrapper.ts` ç¬¬49è¡Œ

```typescript
public async executeWithUnlockLock<T>(
    operationName: string, 
    operation: () => Promise<T>
): Promise<T | null> {
    Logger.log(`ğŸš€ å¼€å§‹æ‰§è¡Œå†™å…¥æ“ä½œ: ${operationName}`);
    
    // ğŸ›¡ï¸ å…œåº•é˜²å¾¡ï¼šæ£€æŸ¥æ–‡æ¡£æ˜¯å¦å¤„äºå¯ç¼–è¾‘çŠ¶æ€ï¼Œå¦‚æœæ˜¯åˆ™æ‹’ç»æ“ä½œ
    if (isCurrentDocumentEditable()) {
        Logger.error(`ğŸ›¡ï¸ å…œåº•é˜²å¾¡è§¦å‘ï¼šæ–‡æ¡£å¤„äºå¯ç¼–è¾‘çŠ¶æ€ï¼Œæ‹’ç»æ‰§è¡Œ ${operationName} æ“ä½œ`);
        throw new Error(`æ–‡æ¡£æœªé”å®šï¼Œç¦æ­¢æ‰§è¡Œ ${operationName} æ“ä½œ`);
    }
    
    // æ­¥éª¤1: ğŸ”“ æ— è„‘è§£é”
    const unlocked = await this.forceUnlock(operationName);
    
    // æ­¥éª¤2: âš¡ æ‰§è¡Œæ“ä½œ
    result = await operation();
    
    // æ­¥éª¤3: ğŸ”’ æ— è„‘åŠ é”
    await this.forceLock(operationName);
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… æ‰§è¡Œæ“ä½œå‰æ£€æŸ¥ï¼ˆç¬¬49è¡Œä½¿ç”¨ `isCurrentDocumentEditable()`ï¼‰
- âš ï¸ **é—®é¢˜**ï¼šforceUnlock å’Œ forceLock é‡Œçš„é”æŒ‰é’®è·å–æ²¡ç”¨ç»Ÿä¸€å·¥å…·ï¼

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### operationWrapper ä¸­çš„é”æŒ‰é’®è·å–æ–¹å¼å·²ç»Ÿä¸€

**ä¿®å¤å‰**ï¼ˆç¬¬84è¡Œå’Œç¬¬123è¡Œï¼‰ï¼š
```typescript
// âŒ ç›´æ¥ç”¨ document.querySelectorï¼Œå¯èƒ½æ‹¿é”™tab
const readonlyBtn = document.querySelector('.protyle-breadcrumb button[data-type="readonly"]');
```

**ä¿®å¤å**ï¼š
```typescript
// âœ… ä½¿ç”¨ç»Ÿä¸€å·¥å…·ï¼Œè·å–å½“å‰æ´»è·ƒtabçš„é”æŒ‰é’®
const readonlyBtn = getCurrentActiveReadonlyButton();
```

**ä¿®å¤å†…å®¹**ï¼š
- âœ… forceUnlock() æ–¹æ³•å·²ä½¿ç”¨ç»Ÿä¸€å·¥å…·ï¼ˆç¬¬85è¡Œï¼‰
- âœ… forceLock() æ–¹æ³•å·²ä½¿ç”¨ç»Ÿä¸€å·¥å…·ï¼ˆç¬¬125è¡Œï¼‰
- âœ… ç¡®ä¿åœ¨å¤štabåœºæ™¯ä¸‹æ“ä½œæ­£ç¡®çš„é”æŒ‰é’®

---

## ğŸ“Š è§¦å‘æ—¶æœºå¯¹æ¯”è¡¨

| æ—¶æœº | ä½ç½® | ä½¿ç”¨ç»Ÿä¸€å·¥å…· | å®æ—¶æ€§ | å¤‡æ³¨ |
|------|------|------------|--------|------|
| **ç‚¹å‡»é”æŒ‰é’®** | readonlyStateMonitor | âœ… | âš¡ ç«‹å³ | æ–°å¢ï¼Œä¸»åŠ¨ç›‘å¬ |
| **Tabåˆ‡æ¢** | toolbarHijacker | âŒ | â±ï¸ å»¶è¿Ÿ | åˆ·æ–°editingStateCache |
| **é€‰ä¸­æ–‡æœ¬** | customToolbarManager | âœ… | â±ï¸ è§¦å‘æ—¶ | æ¯æ¬¡é€‰ä¸­éƒ½æ£€æŸ¥ |
| **ç‚¹å‡»é«˜äº®** | highlightClickManager | âœ… | â±ï¸ è§¦å‘æ—¶ | ç‚¹å‡»æ—¶æ£€æŸ¥ |
| **å³é”®/é•¿æŒ‰å—** | tagManager | âœ… | â±ï¸ è§¦å‘æ—¶ | æ“ä½œå‰æ£€æŸ¥ |
| **å†™å…¥æ“ä½œå‰** | operationWrapper | âœ… | â±ï¸ è§¦å‘æ—¶ | å…œåº•é˜²å¾¡ |
| **å¼ºåˆ¶è§£é”** | operationWrapper | âœ… | â±ï¸ è§¦å‘æ—¶ | âœ… **å·²ä¿®å¤** |
| **å¼ºåˆ¶åŠ é”** | operationWrapper | âœ… | â±ï¸ è§¦å‘æ—¶ | âœ… **å·²ä¿®å¤** |

---

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

### ç”¨æˆ·ç‚¹å‡»é”æŒ‰é’®åçš„å®Œæ•´é“¾è·¯

```
ç”¨æˆ·ç‚¹å‡»é”æŒ‰é’® ğŸ”’
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. readonlyStateMonitor æ•è·ç‚¹å‡»   â”‚
â”‚    (äº‹ä»¶ä»£ç† + MutationObserver)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ 150mså»¶è¿Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è°ƒç”¨ getCurrentActiveReadonlyButton() â”‚
â”‚    â†’ è·å–å½“å‰tabçš„é”æŒ‰é’®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è°ƒç”¨ isCurrentDocumentReadonly() â”‚
â”‚    â†’ åˆ¤æ–­æ–°çš„çŠ¶æ€                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ¯”è¾ƒæ–°æ—§çŠ¶æ€                      â”‚
â”‚    â†’ å¦‚æœæ”¹å˜ï¼Œé€šçŸ¥è®¢é˜…è€…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. CustomToolbarManager æ”¶åˆ°é€šçŸ¥   â”‚
â”‚    â†’ å¦‚æœè§£é”ï¼Œç«‹å³éšè—å·¥å…·æ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”¨æˆ·é€‰ä¸­æ–‡æœ¬çš„æµç¨‹

```
ç”¨æˆ·é€‰ä¸­æ–‡æœ¬
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. customToolbarManager æ£€æµ‹é€‰åŒº    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è°ƒç”¨ getCurrentActiveReadonlyButton() â”‚
â”‚    â†’ è·å–å½“å‰tabçš„é”æŒ‰é’®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ£€æŸ¥å›¾æ ‡hrefåˆ¤æ–­æ˜¯å¦åªè¯»          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¦‚æœåªè¯»ï¼Œæ˜¾ç¤ºå·¥å…·æ               â”‚
â”‚    å¦‚æœå¯ç¼–è¾‘ï¼Œä¸æ˜¾ç¤º                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ€»ç»“

### å·²å®ç°çš„è§¦å‘æ—¶æœºï¼ˆ6ä¸ªï¼‰

1. âœ… **ç‚¹å‡»é”æŒ‰é’®** - ä¸»åŠ¨ç›‘å¬ï¼Œç«‹å³å“åº”
2. âœ… **Tabåˆ‡æ¢** - å¤šé‡ç›‘å¬ï¼Œåˆ·æ–°çŠ¶æ€ç¼“å­˜
3. âœ… **é€‰ä¸­æ–‡æœ¬** - æ˜¾ç¤ºå·¥å…·æ å‰æ£€æŸ¥
4. âœ… **ç‚¹å‡»é«˜äº®** - åˆ é™¤å‰æ£€æŸ¥
5. âœ… **å³é”®/é•¿æŒ‰** - æ‰“æ ‡ç­¾å‰æ£€æŸ¥
6. âœ… **å†™å…¥æ“ä½œå‰** - å…œåº•é˜²å¾¡æ£€æŸ¥

### ~~éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼ˆ2å¤„ï¼‰~~ âœ… å·²å…¨éƒ¨ä¿®å¤

1. âœ… **operationWrapper.forceUnlock** (ç¬¬85è¡Œ) - å·²ä½¿ç”¨ `getCurrentActiveReadonlyButton()`
2. âœ… **operationWrapper.forceLock** (ç¬¬125è¡Œ) - å·²ä½¿ç”¨ `getCurrentActiveReadonlyButton()`

### å›ç­”ä½ çš„é—®é¢˜

> "æ•´ç†ä¸‹ ç›®å‰æ˜¯ç‚¹å‡»äº†é” å’Œtabåˆ‡æ¢ éƒ½ä¼šè¯†åˆ«ä¸€ä¸‹ å¯¹å—?"

âœ… **å¯¹çš„ï¼**
- **ç‚¹å‡»é”** â†’ readonlyStateMonitor ç«‹å³æ•è·å¹¶è¯†åˆ«
- **Tabåˆ‡æ¢** â†’ toolbarHijacker å¤šç§æ–¹å¼ç›‘å¬å¹¶åˆ·æ–°çŠ¶æ€

> "è¿˜æœ‰ä»€ä¹ˆæ—¶å€™ä¼šè¯†åˆ«?"

âœ… **è¿˜æœ‰4ä¸ªæ—¶æœº**ï¼š
- é€‰ä¸­æ–‡æœ¬æ—¶
- ç‚¹å‡»é«˜äº®æ–‡æœ¬æ—¶
- å³é”®/é•¿æŒ‰å—æ—¶
- æ‰§è¡Œå†™å…¥æ“ä½œå‰ï¼ˆå…œåº•é˜²å¾¡ï¼‰

> "æˆ‘è®°å¾—æˆ‘è¿˜æœ‰ä¸ªwrapper ä½ é‚£é‡Œæ”¹äº†å—?"

âœ… **å·²å…¨éƒ¨æ”¹å®Œ**ï¼š
- âœ… ç¬¬49è¡Œçš„ `isCurrentDocumentEditable()` æ£€æŸ¥å·²ä½¿ç”¨ç»Ÿä¸€å·¥å…·
- âœ… ç¬¬85è¡Œçš„ `forceUnlock()` é‡Œçš„é”æŒ‰é’®è·å–**å·²ä¿®å¤**
- âœ… ç¬¬125è¡Œçš„ `forceLock()` é‡Œçš„é”æŒ‰é’®è·å–**å·²ä¿®å¤**

**ä¿®å¤å®Œæˆ**ï¼šç°åœ¨ operationWrapper çš„æ‰€æœ‰åœ°æ–¹éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ `getCurrentActiveReadonlyButton()` å·¥å…·ï¼

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-02  
**çŠ¶æ€**: âœ… 6ä¸ªè§¦å‘æ—¶æœºå·²å®ç° + operationWrapper å·²å®Œå…¨ç»Ÿä¸€  
**æ„å»º**: âœ… æˆåŠŸ (178.94 kB â”‚ gzip: 47.06 kB)

