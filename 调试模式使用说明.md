# 调试模式使用说明

**更新日期**: 2025-10-02  
**版本**: v1.2.2  
**功能**: 可控的调试日志开关

## 🎯 功能说明

为了保持控制台干净整洁，插件默认**关闭所有调试日志**。只有在需要调试时，才通过控制台命令开启。

### 💡 设计理念

- 🔒 **默认关闭** - 启动时控制台安静，不打扰用户
- 🎛️ **即时切换** - 随时可以开启/关闭，无需重启
- ⚠️ **保留警告** - 警告和错误始终显示，不受开关影响
- 🎨 **彩色提示** - 开关状态用醒目的颜色提示

## 🎮 控制台命令

### 1️⃣ 全局调试模式（推荐）

控制所有调试日志的开关：

```javascript
// 开启全局调试模式
debugMode.enable()

// 关闭全局调试模式（默认状态）
debugMode.disable()

// 查看当前状态
debugMode.status()
```

**效果演示**：

#### 开启调试模式
```
🔓 调试模式已开启
💡 提示: 使用 debugMode.disable() 关闭调试
```
<span style="color: #4CAF50; font-weight: bold;">绿色加粗显示</span>

#### 关闭调试模式
```
🔒 调试模式已关闭
💡 提示: 使用 debugMode.enable() 开启调试
```
<span style="color: #f44336; font-weight: bold;">红色加粗显示</span>

#### 查看状态
```
调试模式状态: 🔓 开启
或
调试模式状态: 🔒 关闭
```

---

### 2️⃣ 功能模块调试（精细控制）

如果只想调试特定功能模块：

```javascript
// 高亮点击调试
highlightDebug.enable()   // 开启
highlightDebug.disable()  // 关闭

// 标签管理调试
tagDebug.enable()         // 开启
tagDebug.disable()        // 关闭

// 标签点击调试
tagClickDebug.enable()    // 开启
tagClickDebug.disable()   // 关闭
```

⚠️ **注意**：这些功能调试独立于全局调试模式。

---

### 3️⃣ 其他实用命令

```javascript
// 检查劫持状态
testHijack()
```

## 📊 日志级别说明

### 受调试开关控制的日志

这些日志**只在开启调试模式时显示**：

| 方法 | 用途 | 示例 |
|------|------|------|
| `Logger.log()` | 普通日志 | 功能流程、状态变化 |
| `Logger.info()` | 信息日志 | 配置信息、初始化 |
| `Logger.debug()` | 调试日志 | 详细的调试信息 |
| `Logger.success()` | 成功日志 | 操作成功提示 |
| `Logger.table()` | 表格日志 | 数据展示 |
| `Logger.module()` | 模块日志 | 功能模块输出 |

### 始终显示的日志

这些日志**不受调试开关影响，始终显示**：

| 方法 | 用途 | 示例 |
|------|------|------|
| `Logger.warn()` | 警告日志 | ⚠️ 潜在问题 |
| `Logger.error()` | 错误日志 | ❌ 错误信息 |
| `Logger.fail()` | 失败日志 | ❌ 操作失败 |

**为什么始终显示？**
- 警告和错误是重要信息，用户需要知道
- 即使关闭调试，也能发现问题

## 🎬 使用场景

### 场景1: 日常使用（默认）

**状态**: 调试模式关闭 🔒

**控制台表现**:
```
[HIGH_ASSISTANT] 🎉 高亮助手已加载
[HIGH_ASSISTANT] 💡 调试模式默认关闭，使用 debugMode.enable() 开启
```

只显示欢迎信息，非常简洁！

---

### 场景2: 排查问题

**步骤**:
1. 打开控制台 (F12)
2. 输入 `debugMode.enable()`
3. 重现问题
4. 观察详细日志
5. 排查完成后输入 `debugMode.disable()`

**控制台表现**:
```
[HIGH_ASSISTANT] 🔓 调试模式已开启
[HIGH_ASSISTANT] 💡 提示: 使用 debugMode.disable() 关闭调试

[HIGH_ASSISTANT] 📡 [StateMonitor] 启动只读状态监听...
[HIGH_ASSISTANT] 🔍 [ReadonlyButton] 开始查找当前活跃文档的锁按钮...
[HIGH_ASSISTANT] ✅ [ReadonlyButton] 策略2成功 - 通过焦点元素找到锁按钮
[HIGH_ASSISTANT] 🔄 [StateMonitor] 状态变化: { 旧状态: '未知', 新状态: '🔒 只读' }
... (详细日志)
```

---

### 场景3: 功能开发

**状态**: 调试模式开启 🔓

**步骤**:
1. 修改代码
2. 重新加载插件
3. 自动显示所有调试日志
4. 验证功能

**适合**: 插件开发者

---

### 场景4: 精细调试

只想看某个功能的日志：

```javascript
// 只开启高亮点击的调试
highlightDebug.enable()

// 其他日志保持关闭
```

## 📋 启动时的日志对比

### 关闭调试模式（默认）

```
[HIGH_ASSISTANT] 🎉 高亮助手已加载
[HIGH_ASSISTANT] 💡 调试模式默认关闭，使用 debugMode.enable() 开启
```

仅显示2行，非常干净！✨

---

### 开启调试模式

```
[HIGH_ASSISTANT] 🎉 高亮助手已加载
[HIGH_ASSISTANT] 💡 调试模式默认关闭，使用 debugMode.enable() 开启
[HIGH_ASSISTANT] 🔓 调试模式已开启
[HIGH_ASSISTANT] [Plugin] 🔔 启动只读状态监听器...
[HIGH_ASSISTANT] 📡 [StateMonitor] 启动只读状态监听...
[HIGH_ASSISTANT] [Plugin] 在 onLayoutReady 中启动工具栏劫持...
[HIGH_ASSISTANT] 🔍 开始查找当前活跃文档的锁按钮...
[HIGH_ASSISTANT] ✅ 工具栏劫持成功
[HIGH_ASSISTANT] 💡 可用命令:
[HIGH_ASSISTANT]   🎛️  调试模式控制:
[HIGH_ASSISTANT]     - debugMode.enable() - 开启全局调试模式
[HIGH_ASSISTANT]     - debugMode.disable() - 关闭全局调试模式
...
```

显示完整的调试信息！🔍

## 🎨 视觉效果

### 开启调试
```
 🔓 调试模式已开启  ← 绿色加粗
```

### 关闭调试
```
 🔒 调试模式已关闭  ← 红色加粗
```

### 状态查询（开启）
```
 调试模式状态: 🔓 开启  ← 绿色加粗
```

### 状态查询（关闭）
```
 调试模式状态: 🔒 关闭  ← 红色加粗
```

## 💾 持久化

⚠️ **当前实现**：调试开关**不会持久化**

- 每次刷新页面/重启思源，默认恢复为关闭状态
- 需要手动输入 `debugMode.enable()` 开启

✨ **优点**：
- 避免用户忘记关闭调试，导致控制台一直有日志
- 保持默认的干净状态

## 🔧 技术实现

### Logger 类改造

```typescript
class Logger {
    private static debugEnabled: boolean = false; // 默认关闭
    
    static enableDebug(): void {
        this.debugEnabled = true;
        console.log('🔓 调试模式已开启', '...');
    }
    
    static disableDebug(): void {
        this.debugEnabled = false;
        console.log('🔒 调试模式已关闭', '...');
    }
    
    static log(...args: any[]): void {
        if (!this.debugEnabled) return; // 检查开关
        console.log(this.PREFIX, ...args);
    }
    
    static warn(...args: any[]): void {
        // 警告始终显示，不检查开关
        console.warn(this.PREFIX, ...args);
    }
}
```

### 全局命令注册

```typescript
// index.ts
(window as any).debugMode = {
    enable: () => Logger.enableDebug(),
    disable: () => Logger.disableDebug(),
    status: () => Logger.showDebugStatus()
};
```

## 📖 完整命令列表

### 调试模式控制
```javascript
debugMode.enable()     // 开启全局调试
debugMode.disable()    // 关闭全局调试
debugMode.status()     // 查看状态
```

### 功能调试
```javascript
testHijack()                  // 检查劫持状态
highlightDebug.enable()       // 高亮点击调试
highlightDebug.disable()
tagDebug.enable()             // 标签管理调试
tagDebug.disable()
tagClickDebug.enable()        // 标签点击调试
tagClickDebug.disable()
```

## 🎯 最佳实践

### 1. 日常使用
- ✅ 保持调试模式关闭（默认）
- ✅ 享受干净的控制台

### 2. 遇到问题
- ✅ 立即开启调试模式
- ✅ 观察日志找到问题
- ✅ 问题解决后关闭

### 3. 反馈问题
- ✅ 开启调试模式
- ✅ 复制相关日志
- ✅ 提交给开发者

### 4. 插件开发
- ✅ 开发时可以一直开启
- ✅ 测试时关闭验证体验

## 📊 对比总结

| 方面 | 关闭调试（默认） | 开启调试 |
|------|----------------|----------|
| **控制台噪音** | ✅ 非常干净 | ⚠️ 信息量大 |
| **启动日志** | 2行简洁提示 | 完整调试信息 |
| **运行日志** | 仅警告/错误 | 所有日志 |
| **性能影响** | ✅ 最小 | ⚠️ 略有影响 |
| **适合场景** | 日常使用 | 问题排查 |
| **用户体验** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

## ✅ 构建信息

```bash
npm run build
✓ 25 modules transformed.
dist/index.js   180.30 kB │ gzip: 47.52 kB
✓ built in 673ms
```

- **新增代码**: ~100行
- **文件大小增加**: ~1.4 kB
- **功能**: 完整的调试开关控制

---

**更新日期**: 2025-10-02  
**功能状态**: ✅ 已实现  
**默认状态**: 🔒 关闭  
**推荐使用**: `debugMode.enable()` 和 `debugMode.disable()`

