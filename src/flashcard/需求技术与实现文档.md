# é—ªå¡å¿«åˆ‡åŠŸèƒ½ - éœ€æ±‚æŠ€æœ¯ä¸å®ç°æ–‡æ¡£

## 1. éœ€æ±‚åˆ†æ

### 1.1 åŠŸèƒ½æ¦‚è¿°
ä¸ºæ€æºç¬”è®°çš„é—ªå¡ç³»ç»Ÿæä¾›å¿«é€Ÿç­›é€‰åˆ‡æ¢åŠŸèƒ½ï¼Œé¿å…ç”¨æˆ·æ¯æ¬¡éƒ½éœ€è¦åœ¨é•¿æ–‡æ¡£æ ‘ä¸­æ‰‹åŠ¨å¯»æ‰¾ç›®æ ‡æ–‡æ¡£/ç¬”è®°æœ¬è¿›è¡Œç­›é€‰ã€‚

### 1.2 ç”¨æˆ·ç—›ç‚¹
- é—ªå¡ç­›é€‰éœ€è¦åœ¨å¤æ‚çš„æ–‡æ¡£æ ‘ä¸­å¯¼èˆªï¼Œæ“ä½œç¹ç
- å¸¸ç”¨çš„ç­›é€‰ç›®æ ‡éœ€è¦é‡å¤æŸ¥æ‰¾ï¼Œæ•ˆç‡ä½ä¸‹
- ç¼ºä¹ç­›é€‰å†å²è®°å½•ï¼Œæ— æ³•å¿«é€Ÿå›åˆ°ä¹‹å‰çš„ç­›é€‰çŠ¶æ€

### 1.3 ç›®æ ‡ç”¨æˆ·
ç»å¸¸ä½¿ç”¨æ€æºç¬”è®°é—ªå¡åŠŸèƒ½çš„ç”¨æˆ·ï¼Œç‰¹åˆ«æ˜¯æœ‰å¤šä¸ªæ–‡æ¡£/ç¬”è®°æœ¬éœ€è¦é¢‘ç¹åˆ‡æ¢ç­›é€‰çš„ç”¨æˆ·ã€‚

## 2. åŠŸèƒ½è®¾è®¡

### 2.1 æ ¸å¿ƒåŠŸèƒ½
1. **ç­›é€‰ç›‘å¬** - è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·é€šè¿‡"æ–‡ä»¶æ ‘"è¿›è¡Œçš„é—ªå¡ç­›é€‰æ“ä½œ
2. **å†å²è®°å½•** - ä¿å­˜æœ€è¿‘ä½¿ç”¨çš„ç­›é€‰ç›®æ ‡ï¼ˆæœ€å¤š10æ¡ï¼‰
3. **å¿«é€Ÿåˆ‡æ¢** - æä¾›æµ®çª—ç•Œé¢ï¼Œä¸€é”®åˆ‡æ¢åˆ°å†å²ç­›é€‰ç›®æ ‡
4. **æ™ºèƒ½ç®¡ç†** - æ”¯æŒå›ºå®šã€åˆ é™¤ã€å»é‡å’Œä½¿ç”¨é¢‘æ¬¡ç»Ÿè®¡

### 2.2 ç•Œé¢è®¾è®¡
- **è§¦å‘å…¥å£**ï¼šå°åœ†çƒæµ®çª—ï¼Œæ‚¬æµ®åœ¨é—ªå¡é¢æ¿ä¸Š
- **ä¸»ç•Œé¢**ï¼šæ‰å¹³è¡¨æ ¼ï¼Œæ˜¾ç¤ºç­›é€‰å†å²åˆ—è¡¨
- **æ“ä½œæŒ‰é’®**ï¼šå›ºå®š/å–æ¶ˆå›ºå®šã€åˆ é™¤ã€ç›´æ¥åˆ‡æ¢

### 2.3 äº¤äº’æµç¨‹
```
ç”¨æˆ·ä½¿ç”¨é—ªå¡ç­›é€‰ â†’ è‡ªåŠ¨è®°å½•åˆ°å†å² â†’ ç”¨æˆ·ç‚¹å‡»åœ†çƒ â†’ æ˜¾ç¤ºå†å²åˆ—è¡¨ â†’ ç‚¹å‡»å†å²é¡¹ â†’ è‡ªåŠ¨åˆ‡æ¢ç­›é€‰
```

## 3. æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 æ¶æ„è®¾è®¡
```
FlashcardQuickSwitchManager (ä¸»ç®¡ç†å™¨)
â”œâ”€â”€ FlashcardMonitor (é—ªå¡ç­›é€‰ç›‘å¬å™¨)
â”œâ”€â”€ HistoryManager (å†å²è®°å½•ç®¡ç†å™¨)  
â”œâ”€â”€ UIManager (ç•Œé¢ç®¡ç†å™¨)
â””â”€â”€ DataPersistence (æ•°æ®æŒä¹…åŒ–)
```

### 3.2 æ ¸å¿ƒæ¨¡å—èŒè´£

#### 3.2.1 FlashcardMonitor (é—ªå¡ç­›é€‰ç›‘å¬å™¨)
- ç›‘å¬æ€æºé—ªå¡é¢æ¿çš„ç­›é€‰æ“ä½œ
- è¯†åˆ«ç­›é€‰ç±»å‹ï¼ˆæ–‡æ¡£/ç¬”è®°æœ¬ï¼‰å’Œç›®æ ‡ID
- å°†ç­›é€‰äº‹ä»¶ä¼ é€’ç»™å†å²ç®¡ç†å™¨

#### 3.2.2 HistoryManager (å†å²è®°å½•ç®¡ç†å™¨)
- ç®¡ç†ç­›é€‰å†å²æ•°æ®ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- å®ç°å»é‡é€»è¾‘
- å¤„ç†å›ºå®šçŠ¶æ€å’Œä½¿ç”¨é¢‘æ¬¡ç»Ÿè®¡
- ç»´æŠ¤æœ€å¤š10æ¡è®°å½•çš„é™åˆ¶

#### 3.2.3 UIManager (ç•Œé¢ç®¡ç†å™¨)
- æ¸²æŸ“å°åœ†çƒæµ®çª—
- ç®¡ç†å†å²åˆ—è¡¨å¼¹çª—
- å¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶
- æ‰§è¡Œç­›é€‰åˆ‡æ¢æ“ä½œ

#### 3.2.4 DataPersistence (æ•°æ®æŒä¹…åŒ–)
- JSONæ–‡ä»¶è¯»å†™
- æ’ä»¶å¸è½½æ—¶æ¸…ç†æ•°æ®
- æ•°æ®æ ¼å¼éªŒè¯å’Œè¿ç§»

### 3.3 æ•°æ®ç»“æ„

#### 3.3.1 ç­›é€‰å†å²è®°å½•
```typescript
interface FlashcardFilter {
    id: string;              // æ–‡æ¡£IDæˆ–ç¬”è®°æœ¬ID
    name: string;            // æ˜¾ç¤ºåç§°
    type: 'doc' | 'notebook'; // ç­›é€‰ç±»å‹
    useCount: number;        // ä½¿ç”¨æ¬¡æ•°
    isPinned: boolean;       // æ˜¯å¦å›ºå®š
    lastUsed: number;        // æœ€åä½¿ç”¨æ—¶é—´æˆ³
    createdAt: number;       // åˆ›å»ºæ—¶é—´æˆ³
}

interface FlashcardQuickSwitchData {
    version: string;                    // æ•°æ®æ ¼å¼ç‰ˆæœ¬
    filters: FlashcardFilter[];         // ç­›é€‰å†å²åˆ—è¡¨
    maxCount: number;                   // æœ€å¤§è®°å½•æ•°ï¼ˆé»˜è®¤10ï¼‰
}
```

#### 3.3.2 å­˜å‚¨è·¯å¾„
```
data/storage/flashcard-quick-switch.json
```

### 3.4 ç›‘å¬æœºåˆ¶

#### 3.4.1 æ€æºé—ªå¡ç­›é€‰æ£€æµ‹
ç›‘å¬æ€æºé—ªå¡é¢æ¿ä¸­ç­›é€‰æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼š
```typescript
// ç›‘å¬ç­›é€‰æŒ‰é’®ç‚¹å‡»
document.addEventListener('click', (event) => {
    const filterButton = event.target.closest('[data-type="filter"]');
    if (filterButton) {
        // æ£€æµ‹åˆ°ç­›é€‰æ“ä½œ
    }
});
```

#### 3.4.2 ç­›é€‰ç»“æœæ•è·
é€šè¿‡ç›‘å¬APIè°ƒç”¨æˆ–DOMå˜åŒ–æ£€æµ‹ç­›é€‰ç»“æœï¼š
```typescript
// ç›‘å¬ç­›é€‰APIè°ƒç”¨
// /api/riff/getTreeRiffDueCards æˆ– /api/riff/getNotebookRiffDueCards
```

## 4. å®ç°ç»†èŠ‚

### 4.1 å†å²è®°å½•ç®¡ç†é€»è¾‘

#### 4.1.1 æ·»åŠ æ–°è®°å½•
```typescript
addFilter(filter: Omit<FlashcardFilter, 'useCount' | 'lastUsed' | 'createdAt'>) {
    const existing = this.findExistingFilter(filter.id);
    
    if (existing) {
        // å»é‡ï¼šæ›´æ–°ç°æœ‰è®°å½•
        existing.useCount++;
        existing.lastUsed = Date.now();
        existing.name = filter.name; // æ›´æ–°å¯èƒ½å˜åŒ–çš„åç§°
    } else {
        // æ£€æŸ¥æ˜¯å¦å·²æ»¡ï¼ˆæ‰€æœ‰å›ºå®šï¼‰
        const pinnedCount = this.filters.filter(f => f.isPinned).length;
        const unpinnedCount = this.filters.length - pinnedCount;
        
        if (pinnedCount >= this.maxCount) {
            // 10ä¸ªéƒ½è¢«å›ºå®šäº†ï¼Œä¸æ·»åŠ æ–°è®°å½•
            console.log('æ‰€æœ‰ä½ç½®éƒ½è¢«å›ºå®šï¼Œæ— æ³•æ·»åŠ æ–°è®°å½•');
            return;
        }
        
        if (this.filters.length >= this.maxCount) {
            this.removeOldestUnpinned(); // ç§»é™¤æœ€æ—§çš„éå›ºå®šè®°å½•
        }
        
        // æ·»åŠ æ–°è®°å½•
        const newFilter: FlashcardFilter = {
            ...filter,
            useCount: 1,
            isPinned: false,
            lastUsed: Date.now(),
            createdAt: Date.now()
        };
        this.filters.push(newFilter);
    }
    
    this.sortFilters();
    this.saveData();
}
```

#### 4.1.2 æ’åºè§„åˆ™
```typescript
sortFilters() {
    this.filters.sort((a, b) => {
        // 1. å›ºå®šé¡¹ä¼˜å…ˆ
        if (a.isPinned !== b.isPinned) {
            return a.isPinned ? -1 : 1;
        }
        
        // 2. æŒ‰ä½¿ç”¨é¢‘æ¬¡é™åº
        if (a.useCount !== b.useCount) {
            return b.useCount - a.useCount;
        }
        
        // 3. æŒ‰æœ€è¿‘ä½¿ç”¨æ—¶é—´é™åº
        return b.lastUsed - a.lastUsed;
    });
}
```

### 4.2 ç•Œé¢å®ç°

#### 4.2.1 å°åœ†çƒæµ®çª—
```typescript
createFloatingBall(): HTMLElement {
    const ball = document.createElement('div');
    ball.className = 'flashcard-quick-switch-ball';
    ball.innerHTML = `
        <svg viewBox="0 0 24 24">
            <use xlink:href="#iconRiffCard"></use>
        </svg>
    `;
    
    // å®šä½å’Œæ ·å¼
    ball.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--b3-theme-primary);
        cursor: pointer;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
    `;
    
    // æ‚¬åœæ•ˆæœ
    ball.addEventListener('mouseenter', () => {
        ball.style.transform = 'scale(1.1)';
    });
    
    ball.addEventListener('mouseleave', () => {
        ball.style.transform = 'scale(1)';
    });
    
    return ball;
}
```

#### 4.2.2 å†å²åˆ—è¡¨å¼¹çª—
```typescript
createHistoryPanel(): HTMLElement {
    const panel = document.createElement('div');
    panel.className = 'flashcard-quick-switch-panel';
    panel.innerHTML = `
        <div class="panel-header">
            <span class="panel-title">é—ªå¡å¿«åˆ‡</span>
            <button class="close-btn" title="å…³é—­">Ã—</button>
        </div>
        <div class="filter-list">
            ${this.renderFilterItems()}
        </div>
        <div class="panel-footer">
            <small class="count-info">${this.getCountInfo()}</small>
        </div>
    `;
    
    // æ ·å¼
    panel.style.cssText = `
        position: fixed;
        top: 150px;
        right: 20px;
        width: 320px;
        max-height: 400px;
        background: var(--b3-theme-background);
        border: 1px solid var(--b3-theme-surface-lighter);
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        z-index: 1001;
        font-size: 14px;
        overflow: hidden;
    `;
    
    return panel;
}

renderFilterItems(): string {
    if (this.filters.length === 0) {
        return `
            <div class="empty-state">
                <div class="empty-icon">ğŸ“‹</div>
                <div class="empty-text">æš‚æ— ç­›é€‰å†å²</div>
                <div class="empty-hint">ä½¿ç”¨é—ªå¡ç­›é€‰åä¼šè‡ªåŠ¨è®°å½•</div>
            </div>
        `;
    }
    
    return this.filters.map(filter => `
        <div class="filter-item" data-id="${filter.id}">
            <div class="filter-info">
                <div class="filter-name" title="${filter.name}">
                    <span class="filter-icon">${filter.type === 'doc' ? 'ğŸ“„' : 'ğŸ“'}</span>
                    ${this.truncateText(filter.name, 20)}
                </div>
                <div class="filter-meta">
                    <span class="use-count">${filter.useCount}æ¬¡</span>
                    <span class="last-used">${this.formatTime(filter.lastUsed)}</span>
                </div>
            </div>
            <div class="filter-actions">
                <button class="pin-btn ${filter.isPinned ? 'pinned' : ''}" 
                        data-id="${filter.id}" 
                        title="${filter.isPinned ? 'å–æ¶ˆå›ºå®š' : 'å›ºå®š'}">
                    ğŸ“Œ
                </button>
                <button class="delete-btn" data-id="${filter.id}" title="åˆ é™¤">
                    ğŸ—‘ï¸
                </button>
            </div>
        </div>
    `).join('');
}
```

### 4.3 ç›‘å¬å®ç°

#### 4.3.1 DOMå˜åŒ–ç›‘å¬
```typescript
setupFlashcardMonitoring() {
    // ç›‘å¬é—ªå¡é¢æ¿çš„åˆ›å»ºå’Œç­›é€‰æ“ä½œ
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
                if (node.nodeType === Node.ELEMENT_NODE) {
                    const element = node as Element;
                    
                    // æ£€æµ‹é—ªå¡é¢æ¿
                    const cardDialog = element.querySelector('[data-key="dialog-viewcards"], [data-key="dialog-opencard"]');
                    if (cardDialog) {
                        this.onFlashcardPanelDetected(cardDialog);
                    }
                    
                    // æ£€æµ‹ç­›é€‰æŒ‰é’®
                    const filterButton = element.querySelector('[data-type="filter"]');
                    if (filterButton) {
                        this.attachFilterMonitoring(filterButton);
                    }
                }
            });
        });
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
}

onFlashcardPanelDetected(panel: Element) {
    // æ˜¾ç¤ºå¿«åˆ‡å°åœ†çƒ
    this.showQuickSwitchBall(panel);
    
    // ç›‘å¬é¢æ¿å…³é—­ï¼Œéšè—å°åœ†çƒ
    const closeButtons = panel.querySelectorAll('[data-type="close"]');
    closeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            this.hideQuickSwitchBall();
        });
    });
}

attachFilterMonitoring(filterButton: Element) {
    filterButton.addEventListener('click', () => {
        // å»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾…ç­›é€‰èœå•å‡ºç°
        setTimeout(() => {
            this.monitorFilterSelection();
        }, 100);
    });
}
```

#### 4.3.2 ç­›é€‰åˆ‡æ¢å®ç°
```typescript
async switchToFilter(filter: FlashcardFilter) {
    try {
        // 1. æ‰¾åˆ°ç­›é€‰æŒ‰é’®
        const filterButton = document.querySelector('[data-type="filter"]') as HTMLElement;
        if (!filterButton) {
            console.error('æ‰¾ä¸åˆ°ç­›é€‰æŒ‰é’®');
            return;
        }
        
        // 2. æ›´æ–°æŒ‰é’®å±æ€§
        filterButton.setAttribute('data-id', filter.id);
        filterButton.setAttribute('data-cardtype', filter.type);
        
        // 3. æ¨¡æ‹Ÿç‚¹å‡»ç­›é€‰æ›´æ–°ï¼ˆè§¦å‘æ€æºåŸæœ‰é€»è¾‘ï¼‰
        const fetchNewRoundEvent = new CustomEvent('fetchNewRound');
        filterButton.dispatchEvent(fetchNewRoundEvent);
        
        // 4. å¦‚æœè‡ªå®šä¹‰äº‹ä»¶ä¸ç”Ÿæ•ˆï¼Œç›´æ¥è°ƒç”¨API
        const apiEndpoint = filter.type === 'doc' 
            ? '/api/riff/getTreeRiffDueCards'
            : '/api/riff/getNotebookRiffDueCards';
            
        const response = await fetch(apiEndpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                rootID: filter.id,
                deckID: filter.id,
                notebook: filter.id
            })
        });
        
        if (response.ok) {
            // 5. æ›´æ–°ä½¿ç”¨ç»Ÿè®¡
            this.historyManager.incrementUseCount(filter.id);
            
            // 6. å…³é—­å¿«åˆ‡é¢æ¿
            this.uiManager.hideHistoryPanel();
            
            console.log(`å·²åˆ‡æ¢åˆ°ç­›é€‰: ${filter.name}`);
        }
        
    } catch (error) {
        console.error('åˆ‡æ¢ç­›é€‰å¤±è´¥:', error);
    }
}
```

## 5. é£é™©è€ƒè™‘ä¸è§£å†³æ–¹æ¡ˆ

### 5.1 æŠ€æœ¯é£é™©

#### 5.1.1 æ€æºç‰ˆæœ¬å…¼å®¹æ€§
- **é£é™©**ï¼šæ€æºæ›´æ–°å¯èƒ½æ”¹å˜é—ªå¡é¢æ¿ç»“æ„
- **è§£å†³**ï¼šä½¿ç”¨å®¹é”™æ€§å¼ºçš„é€‰æ‹©å™¨ï¼Œæ·»åŠ ç‰ˆæœ¬æ£€æµ‹å’Œé™çº§å¤„ç†

#### 5.1.2 æ€§èƒ½å½±å“
- **é£é™©**ï¼šé¢‘ç¹çš„DOMç›‘å¬å¯èƒ½å½±å“æ€§èƒ½
- **è§£å†³**ï¼šä½¿ç”¨é˜²æŠ–å¤„ç†ï¼Œä¼˜åŒ–ç›‘å¬èŒƒå›´ï¼Œä»…åœ¨é—ªå¡é¢æ¿æ¿€æ´»æ—¶ç›‘å¬

#### 5.1.3 APIè°ƒç”¨å…¼å®¹æ€§
- **é£é™©**ï¼šæ€æºAPIå˜åŒ–å¯¼è‡´ç­›é€‰åˆ‡æ¢å¤±æ•ˆ
- **è§£å†³**ï¼šå¤šç§åˆ‡æ¢æ–¹æ¡ˆå¤‡é€‰ï¼ŒAPIå¤±æ•ˆæ—¶é™çº§åˆ°DOMæ“ä½œ

### 5.2 ç”¨æˆ·ä½“éªŒé£é™©

#### 5.2.1 ç•Œé¢å†²çª
- **é£é™©**ï¼šæµ®çª—å¯èƒ½é®æŒ¡é‡è¦å†…å®¹
- **è§£å†³**ï¼š
  - æ”¯æŒæ‹–æ‹½è°ƒæ•´ä½ç½®
  - æä¾›è‡ªåŠ¨éšè—é€‰é¡¹
  - æ™ºèƒ½é¿è®©é‡è¦UIå…ƒç´ 

#### 5.2.2 æ•°æ®ä¸¢å¤±
- **é£é™©**ï¼šæ„å¤–åˆ é™¤é‡è¦çš„å†å²è®°å½•
- **è§£å†³**ï¼š
  - åˆ é™¤æ“ä½œéœ€è¦ç¡®è®¤
  - å›ºå®šè®°å½•æœ‰ç‰¹æ®Šæ ‡è¯†
  - æ”¯æŒæ•°æ®å¯¼å‡ºå¤‡ä»½

#### 5.2.3 è¯¯æ“ä½œ
- **é£é™©**ï¼šç”¨æˆ·å¯èƒ½è¯¯è§¦å‘å¿«åˆ‡åŠŸèƒ½
- **è§£å†³**ï¼š
  - å°åœ†çƒæœ‰æ˜ç¡®çš„è§†è§‰åé¦ˆ
  - æä¾›åŠŸèƒ½å¼€å…³é€‰é¡¹
  - æ”¯æŒæ’¤é”€æœ€è¿‘æ“ä½œ

## 6. æµ‹è¯•æ–¹æ¡ˆ

### 6.1 åŠŸèƒ½æµ‹è¯•
- [ ] ç­›é€‰æ“ä½œè‡ªåŠ¨è®°å½•
- [ ] å†å²åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºå’Œæ’åº
- [ ] å¿«é€Ÿåˆ‡æ¢æ­£å¸¸å·¥ä½œ
- [ ] å»é‡é€»è¾‘æ­£ç¡®æ‰§è¡Œ
- [ ] å›ºå®šåŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤æ“ä½œæ­£ç¡®
- [ ] ä½¿ç”¨ç»Ÿè®¡å‡†ç¡®

### 6.2 è¾¹ç•Œæµ‹è¯•
- [ ] 10æ¡è®°å½•ä¸Šé™å¤„ç†
- [ ] å…¨éƒ¨è®°å½•å›ºå®šæ—¶çš„è¡Œä¸º
- [ ] ç©ºå†å²è®°å½•çŠ¶æ€
- [ ] æ’ä»¶å¸è½½æ¸…ç†
- [ ] æ•°æ®æ ¼å¼å¼‚å¸¸å¤„ç†
- [ ] ç½‘ç»œå¼‚å¸¸å¤„ç†

### 6.3 å…¼å®¹æ€§æµ‹è¯•
- [ ] ä¸åŒæ€æºç‰ˆæœ¬å…¼å®¹æ€§
- [ ] ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯é€‚é…
- [ ] ä¸åŒä¸»é¢˜ä¸‹çš„æ ·å¼é€‚é…
- [ ] é«˜DPIå±å¹•é€‚é…

### 6.4 æ€§èƒ½æµ‹è¯•
- [ ] å¤§é‡å†å²è®°å½•æ€§èƒ½
- [ ] ç›‘å¬æœºåˆ¶æ€§èƒ½å½±å“
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§

## 7. éƒ¨ç½²è®¡åˆ’

### 7.1 å¼€å‘é˜¶æ®µ
1. **Phase 1**: æ ¸å¿ƒæ•°æ®ç»“æ„å’ŒæŒä¹…åŒ–å®ç°
   - FlashcardFilteræ¥å£å®šä¹‰
   - HistoryManageråŸºç¡€åŠŸèƒ½
   - JSONæ–‡ä»¶è¯»å†™å’Œæ¸…ç†

2. **Phase 2**: ç›‘å¬æœºåˆ¶å’Œå†å²è®°å½•ç®¡ç†
   - FlashcardMonitorå®ç°
   - ç­›é€‰æ“ä½œæ£€æµ‹å’Œè®°å½•
   - å»é‡å’Œæ’åºé€»è¾‘

3. **Phase 3**: ç•Œé¢å®ç°å’Œç”¨æˆ·äº¤äº’
   - UIManagerç•Œé¢æ¸²æŸ“
   - å°åœ†çƒæµ®çª—å’Œå†å²é¢æ¿
   - ç”¨æˆ·äº¤äº’äº‹ä»¶å¤„ç†

4. **Phase 4**: ç­›é€‰åˆ‡æ¢å’Œé›†æˆ
   - ç­›é€‰åˆ‡æ¢åŠŸèƒ½å®ç°
   - ä¸ç°æœ‰æ’ä»¶æ¶æ„é›†æˆ
   - å…¨æµç¨‹è”è°ƒ

5. **Phase 5**: æµ‹è¯•ä¼˜åŒ–å’Œæ–‡æ¡£å®Œå–„
   - å…¨é¢æµ‹è¯•å’Œbugä¿®å¤
   - æ€§èƒ½ä¼˜åŒ–å’Œå…¼å®¹æ€§å¤„ç†
   - ç”¨æˆ·æ–‡æ¡£å’Œç¤ºä¾‹

### 7.2 å‘å¸ƒç­–ç•¥
- ä½œä¸ºhighlight-assistantæ’ä»¶çš„æ–°åŠŸèƒ½æ¨¡å—
- ç‹¬ç«‹çš„é…ç½®é€‰é¡¹ï¼Œå¯é€‰æ‹©å¯ç”¨/ç¦ç”¨
- è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹
- å‘åå…¼å®¹ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

### 7.3 ç»´æŠ¤è®¡åˆ’
- å®šæœŸæ£€æŸ¥æ€æºç‰ˆæœ¬å…¼å®¹æ€§
- æ”¶é›†ç”¨æˆ·åé¦ˆæŒç»­æ”¹è¿›
- æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- åŠŸèƒ½æ‰©å±•å’Œå¢å¼º

## 8. é…ç½®é€‰é¡¹

### 8.1 ç”¨æˆ·é…ç½®
```typescript
interface QuickSwitchConfig {
    enabled: boolean;           // æ˜¯å¦å¯ç”¨åŠŸèƒ½
    maxHistory: number;         // æœ€å¤§å†å²è®°å½•æ•°ï¼ˆé»˜è®¤10ï¼‰
    ballPosition: {             // å°åœ†çƒä½ç½®
        x: number;
        y: number;
    };
    autoHide: boolean;          // æ˜¯å¦è‡ªåŠ¨éšè—
    showUsageCount: boolean;    // æ˜¯å¦æ˜¾ç¤ºä½¿ç”¨æ¬¡æ•°
    enableDrag: boolean;        // æ˜¯å¦æ”¯æŒæ‹–æ‹½
}
```

### 8.2 é»˜è®¤é…ç½®
```typescript
const DEFAULT_CONFIG: QuickSwitchConfig = {
    enabled: true,
    maxHistory: 10,
    ballPosition: { x: 20, y: 100 },
    autoHide: false,
    showUsageCount: true,
    enableDrag: true
};
```

---

## é™„å½•

### A. ç›¸å…³APIæ–‡æ¡£
- `/api/riff/getTreeRiffDueCards` - è·å–æ–‡æ¡£é—ªå¡
- `/api/riff/getNotebookRiffDueCards` - è·å–ç¬”è®°æœ¬é—ªå¡
- `/api/riff/getRiffDueCards` - è·å–å…¨éƒ¨é—ªå¡

### B. CSSæ ·å¼è§„èŒƒ
```css
.flashcard-quick-switch-ball {
    /* å°åœ†çƒæ ·å¼ */
}

.flashcard-quick-switch-panel {
    /* å†å²é¢æ¿æ ·å¼ */
}

.filter-item {
    /* ç­›é€‰é¡¹æ ·å¼ */
}
```

### C. é”™è¯¯ä»£ç 
- `QS001`: åˆå§‹åŒ–å¤±è´¥
- `QS002`: æ•°æ®åŠ è½½å¤±è´¥
- `QS003`: ç­›é€‰åˆ‡æ¢å¤±è´¥
- `QS004`: æ•°æ®ä¿å­˜å¤±è´¥

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼š1.0*  
*åˆ›å»ºæ—¶é—´ï¼š2024-10-01*  
*æ›´æ–°æ—¶é—´ï¼š2024-10-01*